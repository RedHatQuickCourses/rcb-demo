#  Code Config Example

Here's the detailed educational content for "Code Config Example" in Antora AsciiDoc format, focusing on Tekton's `Task` and `TaskRun` resources.

```asciidoc
[[code-config-example]]
== Code Config Example: Task and TaskRun

The true power of Tekton lies in its declarative nature, defined through Kubernetes-native YAML configurations. Understanding these configuration files is crucial for orchestrating your CI/CD pipelines. This section will walk you through the core YAML structures for `Task` and `TaskRun`, followed by a practical exercise to deploy and observe them.

Tekton `Tasks` define the *what* – the atomic units of work in your pipeline. A `TaskRun` defines the *how* and *when* – an actual execution of a `Task` with specific parameters and resources.

=== Understanding the Tekton Task Configuration

A `Task` is a collection of ordered `steps` that execute within a `Pod` on your Kubernetes cluster. It serves as a reusable template for a specific action, like building a Docker image, running tests, or deploying an application.

Let's examine a simple `Task` definition:

[source,yaml]
----
apiVersion: tekton.dev/v1beta1 # Specifies the Tekton API version.
kind: Task                   # Declares this Kubernetes resource as a Tekton Task.
metadata:
  name: hello-tekton-task    # A unique name for this Task. Follows Kubernetes naming conventions.
  labels:
    app.kubernetes.io/name: hello-world
    app.kubernetes.io/instance: example
spec:
  description: |             # A helpful description of what this Task does.
    This Task prints a greeting message to a specified name.
  params:                    # Defines input parameters that can be passed to the Task.
    - name: name_to_greet
      description: The name to greet in the message.
      type: string           # The expected data type for the parameter.
      default: "Tekton Learner" # A default value if no parameter is provided during TaskRun.
  steps:                     # An ordered list of container-based steps to execute.
    - name: say-hello        # A unique name for this step.
      image: ubuntu:latest   # The container image to use for this step.
      script: |              # The script to execute inside the container.
        #!/usr/bin/env bash
        echo "Hello, $(params.name_to_greet) from Tekton!" # Accessing the parameter value.
----

*   `apiVersion` and `kind`: Standard Kubernetes fields identifying the resource type and API version.
*   `metadata.name`: A unique identifier for your `Task`. This is how `TaskRuns` will reference it.
*   `spec.description`: Provides a clear summary of the `Task`'s purpose. Good practice for maintainability.
*   `spec.params`: Defines inputs that can be provided to the `Task`. These make your `Task` flexible and reusable. Each parameter has a `name`, `description`, `type` (e.g., `string`, `array`), and an optional `default` value.
*   `spec.steps`: The core logic of the `Task`. Each `step` runs as a separate container within the same Kubernetes Pod, sharing the same filesystem.
    *   `name`: A descriptive name for the step.
    *   `image`: The container image to pull and execute.
    *   `script`: The shell script to run inside the container. Tekton automatically mounts this script for execution. Notice how `$(params.name_to_greet)` is used to access the value of the parameter defined earlier.

=== Understanding the Tekton TaskRun Configuration

A `TaskRun` is a request to execute a specific `Task`. It brings the `Task` to life by providing actual values for its parameters, defining workspaces, and setting execution constraints.

Here's a `TaskRun` configuration that executes our `hello-tekton-task`:

[source,yaml]
----
apiVersion: tekton.dev/v1beta1 # Specifies the Tekton API version.
kind: TaskRun                  # Declares this Kubernetes resource as a Tekton TaskRun.
metadata:
  name: hello-tekton-run       # A unique name for this specific execution of the Task.
  labels:
    app.kubernetes.io/name: hello-tekton-example-run
spec:
  taskRef:                     # References the Task to be executed.
    name: hello-tekton-task    # The name of the Task defined previously.
  params:                      # Overrides or sets values for the Task's parameters.
    - name: name_to_greet
      value: "Tekton Enthusiast" # Providing a specific value for the 'name_to_greet' parameter.
  timeout: "5m0s"              # Maximum duration for the TaskRun before it's cancelled.
  serviceAccountName: default  # The Kubernetes ServiceAccount to use for this TaskRun.
----

*   `apiVersion` and `kind`: Standard Kubernetes fields for a `TaskRun`.
*   `metadata.name`: A unique name for this particular execution. Tekton generates a Pod named after this `TaskRun` to execute the steps.
*   `spec.taskRef.name`: This is the crucial link, pointing to the `metadata.name` of the `Task` you want to execute.
*   `spec.params`: This section allows you to pass specific values to the `Task`'s parameters. If a parameter has a `default` value in the `Task` definition and is *not* specified here, the default will be used. Here, we override `"Tekton Learner"` with `"Tekton Enthusiast"`.
*   `spec.timeout`: Sets a maximum duration for the `TaskRun`. If the `TaskRun` takes longer than this, it will be cancelled.
*   `spec.serviceAccountName`: Specifies the Kubernetes Service Account to use for the underlying Pod created by the `TaskRun`. This controls the permissions the `TaskRun` has within the cluster.

=== Hands-on Activity: Deploying and Observing Task and TaskRun

In this activity, you'll apply the Tekton `Task` and `TaskRun` configurations to your Kubernetes cluster and observe their execution.

[[hands-on-deploy-taskrun]]
==== Practical To-do exercise

Before you begin, ensure you have `kubectl` configured to interact with your Kubernetes cluster and `tkn` (the Tekton CLI) installed.

. Create the `Task` Definition
.. Create a new file named `hello-tekton-task.yaml` with the `Task` configuration provided above:
+
[source,bash]
----
cat <<EOF > hello-tekton-task.yaml
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: hello-tekton-task
  labels:
    app.kubernetes.io/name: hello-world
    app.kubernetes.io/instance: example
spec:
  description: |
    This Task prints a greeting message to a specified name.
  params:
    - name: name_to_greet
      description: The name to greet in the message.
      type: string
      default: "Tekton Learner"
  steps:
    - name: say-hello
      image: ubuntu:latest
      script: |
        #!/usr/bin/env bash
        echo "Hello, $(params.name_to_greet) from Tekton!"
EOF
----

.. Apply the `Task` to your cluster:
+
[source,bash]
----
kubectl apply -f hello-tekton-task.yaml
----
+
You should see output similar to:
`task.tekton.dev/hello-tekton-task created`

. Create the `TaskRun` Definition
.. Create a new file named `hello-tekton-run.yaml` with the `TaskRun` configuration provided above:
+
[source,bash]
----
cat <<EOF > hello-tekton-run.yaml
apiVersion: tekton.dev/v1beta1
kind: TaskRun
metadata:
  name: hello-tekton-run
  labels:
    app.kubernetes.io/name: hello-tekton-example-run
spec:
  taskRef:
    name: hello-tekton-task
  params:
    - name: name_to_greet
      value: "Tekton Enthusiast"
  timeout: "5m0s"
  serviceAccountName: default
EOF
----

.. Apply the `TaskRun` to your cluster:
+
[source,bash]
----
kubectl apply -f hello-tekton-run.yaml
----
+
You should see output similar to:
`taskrun.tekton.dev/hello-tekton-run created`

. Monitor the `TaskRun`
.. You can watch the status of your `TaskRun` using `kubectl`:
+
[source,bash]
----
kubectl get taskrun hello-tekton-run -w
----
+
You'll see its status change from `Unknown` to `Running` and eventually to `Succeeded` (or `Failed`).

.. For a more Tekton-specific view and to access logs, use the `tkn` CLI:
+
[source,bash]
----
tkn taskrun describe hello-tekton-run
----
+
This command provides a summary of the `TaskRun`, its status, and the `Task` it references.

.. To view the live logs of the `TaskRun` (and the `say-hello` step), use:
+
[source,bash]
----
tkn taskrun logs hello-tekton-run -f
----
+
You should see the output: `Hello, Tekton Enthusiast from Tekton!`

. Experiment (Optional)
.. Edit `hello-tekton-run.yaml` to change the `name_to_greet` value or remove the `params` section entirely to see the `Task`'s default value in action. Remember to change the `metadata.name` for each new `TaskRun` you create (e.g., `hello-tekton-run-2`) before applying with `kubectl apply -f`.
.. Try applying a `TaskRun` with a non-existent `taskRef` name and observe the error messages in the `TaskRun` status.

This hands-on exercise demonstrates the fundamental workflow: defining a reusable `Task` and then instantiating it with a `TaskRun`, providing specific execution details and observing the results.
```